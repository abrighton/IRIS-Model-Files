subsystem = IRIS
component = oiwfs-adc-assembly

publish {

  events = [
    {
      name              = state
      description       = """
IRIS publishes the OIWFS ADC assembly state for monitoring purposes.
      """
      minRate = 1
      maxRate = 1
      attributes = [
        {
          name          = cmd
          description   = "command state"
          enum          = [UNINITIALIZED,READY,BUSY,CONTINUOUS]
        }
        {
          name          = move1
          description   = "state of adc1 mechanism motion"
          enum          = [STOPPED,MOVING]
        }
        {
          name          = onTarget1
          description   = "adc1 onTarget flag"
          type          = boolean
        }
        {
          name          = move2
          description   = "state of adc1 mechanism motion"
          enum          = [STOPPED,MOVING]
        }
        {
          name          = onTarget2
          description   = "adc1 onTarget flag"
          type          = boolean
        }
        {
          name          = move3
          description   = "state of adc1 mechanism motion"
          enum          = [STOPPED,MOVING]
        }
        {
          name          = onTarget3
          description   = "adc1 onTarget flag"
          type          = boolean
        }        
      ]
    }
    {
      name            = cmdStatus
      description     = "ADC command status"
      attributes      = [
        {
          name        = cmd
          description = "Current command state"
          enum        = [ UNINITIALIZED, READY, BUSY, CONTINUOUS ]
        }
      ]
    }
    {
      name              = target
      minRate = 1
      maxRate = 1
      description       = """Target settings for OIWFS ADCs""" 
      attributes        = [
        {
          name          = trackID1
          description   = "Unique TCS target ID that is incremented (with rollover) each time the TCS is instructed to move to a new target."
          type          = long
        }
        {
          name          = trackID2
          description   = "Unique TCS target ID that is incremented (with rollover) each time the TCS is instructed to move to a new target."
          type          = long
        }
        {
          name          = trackID3
          description   = "Unique TCS target ID that is incremented (with rollover) each time the TCS is instructed to move to a new target."
          type          = long
        }
        {
          name          = power1
          description   = "Target power (differential rotation angle, TBD) for ADC1, inferred from dispersion information."
          type          = double
          units         = degrees
        }
        {
          name          = orientation1
          description   = "Target orientation for ADC1 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation1A
          description   = "Target rotation of the A stage for ADC1 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation1B
          description   = "Target rotation of the B stage for ADC1 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = power2
          description   = "Target power (differential rotation angle, TBD) for ADC2, inferred from dispersion information."
          type          = double
          units         = degrees
        }
        {
          name          = orientation2
          description   = "Target orientation for ADC2 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation2A
          description   = "Target rotation of the A stage for ADC2 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation2B
          description   = "Target rotation of the B stage for ADC2 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = power3
          description   = "Target power (differential rotation angle, TBD) for ADC3, inferred from dispersion information."
          type          = double
          units         = degrees
        }
        {
          name          = orientation3
          description   = "Target orientation for ADC3 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation3A
          description   = "Target rotation of the A stage for ADC3 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation3B
          description   = "Target rotation of the B stage for ADC3 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
      ]
    }
    {
      name              = current
      minRate = 1
      maxRate = 1
      description       = """Current settings of OIWFS ADCs""" 
      attributes        = [
        {
          name          = power1
          description   = "Current power (differential rotation angle, TBD) for ADC1, inferred from dispersion information."
          type          = double
          units         = degrees
        }
        {
          name          = orientation1
          description   = "Current orientation for ADC1 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation1A
          description   = "Current rotation of the A stage for ADC1 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation1B
          description   = "Current rotation of the B stage for ADC1 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = error_rotation1A
          description   = "Error in rotation of the A stage for ADC1"
          type          = double
          units         = degrees
        }
        {
          name          = error_rotation1B
          description   = "Error in rotation of the B stage for ADC1"
          type          = double
          units         = degrees
        }
        {
          name          = power2
          description   = "Current power (differential rotation angle, TBD) for ADC2, inferred from dispersion information."
          type          = double
          units         = degrees
        }
        {
          name          = orientation2
          description   = "Current orientation for ADC2 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation2A
          description   = "Current rotation of the A stage for ADC2 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation2B
          description   = "Current rotation of the B stage for ADC2 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = error_rotation2A
          description   = "Error in rotation of the A stage for ADC2"
          type          = double
          units         = degrees
        }
        {
          name          = error_rotation2B
          description   = "Error in rotation of the B stage for ADC2"
          type          = double
          units         = degrees
        }
        {
          name          = power3
          description   = "Current power (differential rotation angle, TBD) for ADC3, inferred from dispersion information."
          type          = double
          units         = degrees
        }
        {
          name          = orientation3
          description   = "Current orientation for ADC3 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation3A
          description   = "Current rotation of the A stage for ADC3 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = rotation3B
          description   = "Current rotation of the B stage for ADC3 in FCRS<sub>IRIS-ROT</sub>"
          type          = double
          units         = degrees
        }
        {
          name          = error_rotation3A
          description   = "Error in rotation of the A stage for ADC3"
          type          = double
          units         = degrees
        }
        {
          name          = error_rotation3B
          description   = "Error in rotation of the B stage for ADC3"
          type          = double
          units         = degrees
        }
      ]
    }

    {
      name = oiwfsShift
      description = """The expected ADC image shifts of the OIWFS position demands

      The ADC will shift an image position in a manner that depends upon the current state of the ADC. The estimated image shift is published by IRIS for the TCS so that the TCS can adjust the IRIS OIWFS position demands accordingly. The reference wavelength used to calculate the shift for each of the WFS is tcs.cm.iris.oiwfsXAtmDispersion.referenceWavelength.
      """
      minRate = 1
      maxRate = 1
      archive = true
      attributes = [
        {
          name = oiwfs1Shift
          description = "2 element array holding x, y values (range TBD) in the FCRS<sub>IRIS-ROT</sub>, evaluated at the reference wavelength"
          type = array
          dimensions: [2]
          items = {
            type = double
            units = mm
          }
        }
        {
          name = oiwfs2Shift
          description = "2 element array holding x, y values (range TBD) in the FCRS<sub>IRIS-ROT</sub>, evaluated at the reference wavelength"
          type = array
          dimensions: [2]
          items = {
            type = double
            units = mm
          }
        }
        {
          name = oiwfs3Shift
          description = "2 element array holding x, y values (range TBD) in the FCRS<sub>IRIS-ROT</sub>, evaluated at the reference wavelength"
          type = array
          dimensions: [2]
          items = {
            type = double
            units = mm
          }
        }
      ]
    }
  ]

  alarms = [
   {
      name = watchdog
      description = """Assembly has become unresponsive <br><br>
                    <b>Probable Cause:</b> Software bug.<br>
                    (LATCHED=true) <br>
                    (ACTION=
                    <ul>
                        <li><b>Major:</b> Re-start the assembly and file a bug report. </li>
                    </ul>)"""
      severity = major
      archive = true
    }
    {
      name = limitAdc1A
      description = """Rotational stage A of the OIWFS 1 ADC has reached a limit. It is not possible to position the stage. <br><br>
                    <b>Probable Cause:</b> The stage motion control HCD was commanded without the knowledge of the assembly, or the configured soft limits are incorrect. <br>
                    (LATCHED=true) <br>
                    (ACTION=
                    <ul>
                        <li><b>Major:</b> Execute the datum command. </li>
                    </ul>)"""
      severity = major
      archive = true
    }
    {
      name = limitAdc1B
      description = """Rotational stage B of the OIWFS 1 ADC has reached a limit. It is not possible to position the stage. <br><br>
                    <b>Probable Cause:</b> The stage motion control HCD was commanded without the knowledge of the assembly, or the configured soft limits are incorrect. <br>
                    (LATCHED=true) <br>
                    (ACTION=
                    <ul>
                        <li><b>Major:</b> Execute the datum command. </li>
                    </ul>)"""
      severity = major
      archive = true
    }
    {
      name = limitAdc2A
      description = """Rotational stage A of the OIWFS 2 ADC has reached a limit. It is not possible to position the stage. <br><br>
                    <b>Probable Cause:</b> The stage motion control HCD was commanded without the knowledge of the assembly, or the configured soft limits are incorrect. <br>
                    (LATCHED=true) <br>
                    (ACTION=
                    <ul>
                        <li><b>Major:</b> Execute the datum command. </li>
                    </ul>)"""
      severity = major
      archive = true
    }
    {
      name = limitAdc2B
      description = """Rotational stage B of the OIWFS 2 ADC has reached a limit. It is not possible to position the stage. <br><br>
                    <b>Probable Cause:</b> The stage motion control HCD was commanded without the knowledge of the assembly, or the configured soft limits are incorrect. <br>
                    (LATCHED=true) <br>
                    (ACTION=
                    <ul>
                        <li><b>Major:</b> Execute the datum command. </li>
                    </ul>)"""
      severity = major
      archive = true
    }
    {
      name = limitAdc3A
      description = """Rotational stage A of the OIWFS 3 ADC has reached a limit. It is not possible to position the stage. <br><br>
                    <b>Probable Cause:</b> The stage motion control HCD was commanded without the knowledge of the assembly, or the configured soft limits are incorrect. <br>
                    (LATCHED=true) <br>
                    (ACTION=
                    <ul>
                        <li><b>Major:</b> Execute the datum command. </li>
                    </ul>)"""
      severity = major
      archive = true
    }
    {
      name = limitAdc3B
      description = """Rotational stage B of the OIWFS 3 ADC has reached a limit. It is not possible to position the stage. <br><br>
                    <b>Probable Cause:</b> The stage motion control HCD was commanded without the knowledge of the assembly, or the configured soft limits are incorrect. <br>
                    (LATCHED=true) <br>
                    (ACTION=
                    <ul>
                        <li><b>Major:</b> Execute the datum command. </li>
                    </ul>)"""
      severity = major
      archive = true
    }
  ]

}
