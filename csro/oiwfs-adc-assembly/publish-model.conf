subsystem = IRIS
component = oiwfs-adc-assembly

publish {

  telemetry = [
    {
      name              = state
      description       = """
IRIS publishes the OIWFS ADC assembly state for monitoring purposes.
      """
      minRate = 1
      maxRate = 1
      attributes = [
        {
          name          = cmd
          description   = "command state"
          enum          = [UNINITIALIZED,READY,BUSY,CONTINUOUS]
        }
        {
          name          = adc1_move
          description   = "state of adc1 mechanism motion"
          enum          = [STOPPED,MOVING]
        }
        {
          name          = adc1_onTarget
          description   = "adc1 onTarget flag"
          type          = boolean
        }
        {
          name          = adc2_move
          description   = "state of adc1 mechanism motion"
          enum          = [STOPPED,MOVING]
        }
        {
          name          = adc2_onTarget
          description   = "adc1 onTarget flag"
          type          = boolean
        }
        {
          name          = adc3_move
          description   = "state of adc1 mechanism motion"
          enum          = [STOPPED,MOVING]
        }
        {
          name          = adc3_onTarget
          description   = "adc1 onTarget flag"
          type          = boolean
        }        
      ]
    }
    {
      name              = target
      minRate = 1
      maxRate = 1
      description       = """Target dispersions for OIWFS ADCs""" 
      attributes        = [
        {
          name          = referenceWavelength1
          description   = "Reference wavelengths for ADC1 dispersions"
          type          = double
          units         = microns
        }
        {
          name          = orientation1
          description   = "Orientation of dispersion for ADC1 in FCRS<sub>IRIS-ROT</sub>."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = wavelength1
          description   = "An array of wavelengths. Each provided wavelength value must be unique. Range is TBC"
          type          = array
          minItems      = 1
          maxItems      = 30
          minimum       = 0.5
          maximum       = 3.0
          units         = microns
          items         = {
            type        = double
          }
        }
        {
          name          = weight1
          description   = "An array of weights. They must sum to 1.0."
          type          = array
          minItems      = 1
          maxItems      = 30
          minimum       = 0.0
          maximum       = 1.0
          items         = {
            type        = double
          }
        }
        {
          name          = dispersion1
          description   = "An array of atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
        {
          name          = counter1
          description   = "Unique TCS target counter that is incremented (with rollover) each time a new target is acquired. TBD whether this is required."
          type          = long
        }
        {
          name          = referenceWavelength2
          description   = "Reference wavelengths for ADC2 dispersions"
          type          = double
          units         = microns
        }
        {
          name          = orientation2
          description   = "Orientation of dispersion for ADC2 in FCRS<sub>IRIS-ROT</sub>."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = wavelength2
          description   = "An array of wavelengths. Each provided wavelength value must be unique. Range is TBC"
          type          = array
          minItems      = 1
          maxItems      = 30
          minimum       = 0.5
          maximum       = 3.0
          units         = microns
          items         = {
            type        = double
          }
        }
        {
          name          = weight2
          description   = "An array of weights. They must sum to 1.0."
          type          = array
          minItems      = 1
          maxItems      = 30
          minimum       = 0.0
          maximum       = 1.0
          items         = {
            type        = double
          }
        }
        {
          name          = dispersion2
          description   = "An array of atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
        {
          name          = counter2
          description   = "Unique TCS target counter that is incremented (with rollover) each time a new target is acquired. TBD whether this is required."
          type          = long
        }
        {
          name          = referenceWavelength3
          description   = "Reference wavelengths for ADC3 dispersions"
          type          = double
          units         = microns
        }
        {
          name          = orientation3
          description   = "Orientation of dispersion for ADC3 in FCRS<sub>IRIS-ROT</sub>."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = wavelength3
          description   = "An array of wavelengths. Each provided wavelength value must be unique. Range is TBC"
          type          = array
          minItems      = 1
          maxItems      = 30
          minimum       = 0.5
          maximum       = 3.0
          units         = microns
          items         = {
            type        = double
          }
        }
        {
          name          = weight3
          description   = "An array of weights. They must sum to 1.0."
          type          = array
          minItems      = 1
          maxItems      = 30
          minimum       = 0.0
          maximum       = 1.0
          items         = {
            type        = double
          }
        }
        {
          name          = dispersion3
          description   = "An array of atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
        {
          name          = counter3
          description   = "Unique TCS target counter that is incremented (with rollover) each time a new target is acquired. TBD whether this is required."
          type          = long
        }
      ]
    }

    {
      name              = current
      minRate = 1
      maxRate = 1
      description       = """Current dispersions for OIWFS ADCs""" 
      attributes        = [
        {
          name          = orientation1
          description   = "Orientation of dispersion for ADC1 in FCRS<sub>IRIS-ROT</sub>."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = dispersion1
          description   = "An array of atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
                {
          name          = error_orientation1
          description   = "Error in orientation of dispersion for ADC1."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = error_dispersion1
          description   = "Error in atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
        {
          name          = orientation2
          description   = "Orientation of dispersion for ADC2 in FCRS<sub>IRIS-ROT</sub>."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = dispersion2
          description   = "An array of atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
        {
          name          = error_orientation2
          description   = "Error in orientation of dispersion for ADC1."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = error_dispersion2
          description   = "Error in atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
        {
          name          = orientation3
          description   = "Orientation of dispersion for ADC3 in FCRS<sub>IRIS-ROT</sub>."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = dispersion3
          description   = "An array of atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
        {
          name          = error_orientation3
          description   = "Error in orientation of dispersion for ADC1."
          type          = double
          minimum       = -180
          maximum       = 180
          units         = degrees
        }
        {
          name          = error_dispersion3
          description   = "Error in atmospheric dispersion values."
          type          = array
          minItems      = 1
          maxItems      = 30
          units         = arcsec on sky
          items         = {
            type        = double
          }
        }
      ]
    }
    {
      name            = cmdStatus
      description     = "ADC command status"
      attributes      = [
        {
          name        = cmd
          description = "Current command state"
          enum        = [ UNINITIALIZED, READY, BUSY, CONTINUOUS ]
        }
      ]
    }
  ]

  events = [
    {
      name = oiwfsShift
      description = """
IRIS publishes the expected ADC image shifts of the OIWFS position demands

      *The ADC will shift an image position in a manner that depends upon the current state of the ADC. The estimated image shift is sent from IRIS to the TCS so that the TCS can adjust the IRIS OIWFS position demands accordingly. The reference wavelength used to calculate the shift for each of the WFS is tcs.cm.iris.oiwfsXAtmDispersion.referenceWavelength.*
      """
      minRate = 1
      maxRate = 1
      archive = true
      attributes = [
        {
          name = oiwfs1Shift
          description = "2 element array holding x, y values (range TBD) in the FCRS<sub>IRIS-ROT</sub>, evaluated at the reference wavelength"
          type = array
          dimensions: [2]
          items = {
            type = double
            units = mm
          }
        }
        {
          name = oiwfs2Shift
          description = "2 element array holding x, y values (range TBD) in the FCRS<sub>IRIS-ROT</sub>, evaluated at the reference wavelength"
          type = array
          dimensions: [2]
          items = {
            type = double
            units = mm
          }
        }
        {
          name = oiwfs3Shift
          description = "2 element array holding x, y values (range TBD) in the FCRS<sub>IRIS-ROT</sub>, evaluated at the reference wavelength"
          type = array
          dimensions: [2]
          items = {
            type = double
            units = mm
          }
        }
      ]
    }
  ]

}
