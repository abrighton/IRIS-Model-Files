subsystem = IRIS
component = oiwfs-env-assembly

publish {

  description = """
        """

  events = [
    {
      name = "state"
      description = """
The current state of the OIWFS enclosure environment.

The environmental sensor values published with this event are derived from values published by the PLC and are suitable for making control decisions.

<em>
Discussion: The OIWFS Enclosure environment is controlled by a PLC and when commanded will follow the NFIRAOS optical enclosure states.  Frost point is germane below 0<sup>&deg;</sup>C and dewpoint applies above freezing.  Condensation temperature (Frost and dew point ) is a  more directly useful measurement of water vapour than relative humidity --  if the air temperature is below the condensation point, then water will precipitate.

Discussion: Whether IRIS is Mechanically attached to NFIRAOS is reflected in the software 'configuration' of IRIS, so that NFIRAOS NCC knows whether the published values in this table are relevant.
</em>
"""
      minRate = 0.1
      maxRate = 1
      archive = true
      attributes = [
        {
          name = cmd
          description   = "command state"
          enum          = [UNINITIALIZED,READY,BUSY,CONTINUOUS]
        }
        {
          name = temperature
          description = "OIWFS enclosure temperature near the snout."
          type = double
          units = C
        }
        {
          name = relHumidity
          description = "Relative humidity of the OIWFS enclosure."
          type = double
          minimum = 0
          maximum = 100
          units = "%"
        }
        {
          name = humidityPoint
          description = "Current condensation point: < 0 C, Frost point, > 0 C, Dew point."
          type = double
          units = C
        }
        {
          name = state
          description =
"""
State of the enclosure PLC.

There are many more states than those enumerated here: see NFIRAOS optical enclosure state diagram for an example.
"""
          enum = [ COLD | CDPD | CLNG | WRMG | WARM ]
        }
        {
          name = stateEnd
          description = "Timestamp indicating when any defrosting must be done"
          type = taiDate
          units = "TAI / PTP"
        }
        {
          name = connectedNfiraos
          description = "Reflects how IRIS has been configured"
          type = boolean
        }
      ]
    }

    {
      name = "1wireEnvSensors"
      description = """
1wire environment sensor values.

<em>
Discussion: These 1wire sensors are used for informational purposes only as they are not as reliable as those used by the PLC. When sensor values are required to make environmental control decisions, the PLC values should be used instead.
</em>

"""
      minRate = 0.1
      maxRate = 1
      archive = true
      attributes = [
        {
          name = snoutTemp
          description = "temperature in the snout"
          type = double
          units = C
        }
        {
          name = snoutRelHumidity
          description = "relative humidity in the snout"
          type = double
          minimum = 0
          maximum = 100
          units = "%"
        }
        {
          name = snoutHumidityPoint
          description = "Current condensation point in the snout: < 0 C, Frost point, > 0 C, Dew point."
          type = double
          units = C
        }
        {
          name = dewarWindowTemp
          description = "Surface temperature of the dewar window within the OIWFS"
          type = double
          units = C
        }
        {
          name = airTemp
          description = "Air temperature within the main OIWFS cavity"
          type = double
          units = C
        }
        {
          name = relHumidity
          description = "Relative humidity in the main OIWFS cavity"
          type = double
          minimum = 0
          maximum = 100
          units = "%"
        }
        {
          name = relHumidityPoint
          description = "Current condensation point in the main OIWFS cavity: < 0 C, Frost point, > 0 C, Dew point."
          type = double
          units = C
        }
        {
          name = airPressure
          description = "Air pressure in the main OIWFS cavity"
          type = double
          units = Pa 
        }
        {
          name = panelTemp
          description = "Surface temperature on inner OIWFS wall near heating panel"
          type = double
          units = C
        }
      ]
    }

    {
      name = "1wireMotorTemps"
      description = """
1wire motor surface temps
"""
      minRate = 0.1
      maxRate = 1
      archive = true
      attributes = [
        {
          name = rotator
          description = "Instrument rotator motor"
          type = double
          units = C
        }

        {
          name = oiwfs1linear
          description = "oiwfs1 linear stage motor"
          type = double
          units = C
        }
        {
          name = oiwfs1rotation
          description = "oiwfs1 rotation stage motor"
          type = double
          units = C
        }
        {
          name = oiwfs1collimator
          description = "oiwfs1 collimator motor"
          type = double
          units = C
        }
        {
          name = oiwfs1trombone
          description = "oiwfs1 trombone motor"
          type = double
          units = C
        }
        {
          name = oiwfs1TTDeploy
          description = "oiwfs1 TT deploy motor"
          type = double
          units = C
        }
        {
          name = oiwfs1TTFDeploy
          description = "oiwfs1 TTF deploy motor"
          type = double
          units = C
        }
        {
          name = oiwfs1ADC1
          description = "oiwfs1 ADC1 motor"
          type = double
          units = C
        }
        {
          name = oiwfs1ADC2
          description = "oiwfs1 ADC2 motor"
          type = double
          units = C
        }
        
        {
          name = oiwfs2linear
          description = "oiwfs2 linear stage motor"
          type = double
          units = C
        }
        {
          name = oiwfs2rotation
          description = "oiwfs2 rotation stage motor"
          type = double
          units = C
        }
        {
          name = oiwfs2collimator
          description = "oiwfs2 collimator motor"
          type = double
          units = C
        }
        {
          name = oiwfs2trombone
          description = "oiwfs2 trombone motor"
          type = double
          units = C
        }
        {
          name = oiwfs2TTDeploy
          description = "oiwfs2 TT deploy motor"
          type = double
          units = C
        }
        {
          name = oiwfs2TTFDeploy
          description = "oiwfs2 TTF deploy motor"
          type = double
          units = C
        }
                {
          name = oiwfs2ADC1
          description = "oiwfs1 ADC1 motor"
          type = double
          units = C
        }
        {
          name = oiwfs2ADC2
          description = "oiwfs1 ADC2 motor"
          type = double
          units = C
        }

        {
          name = oiwfs3linear
          description = "oiwfs3 linear stage motor"
          type = double
          units = C
        }
        {
          name = oiwfs3rotation
          description = "oiwfs3 rotation stage motor"
          type = double
          units = C
        }
        {
          name = oiwfs3collimator
          description = "oiwfs3 collimator motor"
          type = double
          units = C
        }
        {
          name = oiwfs3trombone
          description = "oiwfs3 trombone motor"
          type = double
          units = C
        }
        {
          name = oiwfs3TTDeploy
          description = "oiwfs3 TT deploy motor"
          type = double
          units = C
        }
        {
          name = oiwfs3TTFDeploy
          description = "oiwfs3 TTF deploy motor"
          type = double
          units = C
        }
        {
          name = oiwfs3ADC1
          description = "oiwfs1 ADC1 motor"
          type = double
          units = C
        }
        {
          name = oiwfs3ADC2
          description = "oiwfs1 ADC2 motor"
          type = double
          units = C
        }
      ]
    }

  ]

}
