subsystem = IRIS
component = ifs-spectralres-assembly

description = """
Commands which can be accepted by IRIS Spectral Resolution Assembly.
"""

receive = [
    {
        name = GRATING_INIT
        description = """
This command causes the functional group to initialize its variables, read configuration, and verify dependencies.  It prepares the assembly internally such that it is available to communicate with outside processes and begin managing the grating turret.  It does not cause any movement or initiate any action on the hardware but, it may validate connections and hardware presence before completing.  This is an internal software assembly initialization only and does not trickle down to other software components or dependencies.

This command can be invoked only when the grating turret is not in motion. All commands will be rejected during the initialization.

Initialization can fail for various reasons including invalid configurations.  In this case, the command state will report the error.
"""
    }
    {
        name = GRATING_DATUM
        description = """
Perform homing of mechanisms, if necessary.

This command can be invoked only when the grating turret is not in motion. All commands except “stop” will be rejected during the datum.

In the event of an error or failure to index, datum will return an error response, the command state will be set to error, and the movement state will be unindexed and the position will be reported as unknown.
"""
    }
    {
        name = GRATING_PARK
        description = """
This command moves the grating turret to the most commonly used position before long sleep of the instrument so that the first observation after wake-up can be started quickly (TBC).
"""
    }
    
    {
        name = FIELDMODE_INIT
        description = """
This command causes the functional group to initialize its variables, read configuration, and verify dependencies.  It prepares the assembly internally such that it is available to communicate with outside processes and begin managing the mechanisms in this functional group.  It does not cause any movement or initiate any action on the hardware but, it may validate connections and hardware presence before completing.  This is an internal software assembly initialization only and does not trickle down to other software components or dependencies.

This command can be invoked only when none of the mechanisms in this functional group is in motion. All commands will be rejected during the initialization.

Initialization can fail for various reasons including invalid configurations.  In this case, the command state will report the error.
"""
    }
    {
        name = FIELDMODE_DATUM
        description = """
Perform homing of mechanisms, if necessary.

This command can be invoked only when none of the mechanisms in this functional group is in motion. All commands except “stop” will be rejected during the datum.

In the event of an error or failure to index, datum will return an error response, the command state will be set to error, and the movement state will be unindexed and the position will be reported as unknown.
"""
    }
    {
        name = FIELDMODE_PARK
        description = """
This command moves the mechanisms to the most commonly used position before long sleep of the instrument so that the first observation after wake-up can be started quickly (TBC).
"""
    }
    
    {
        name = GRATING_SELECT
        description = """
This command changes the grating of IFS. Depends on the chosen grating groove density, grating mechanism will rotate accordingly.

This command can be invoked only when the grating turret is not in motion.

The list of groove densities are as written on [IRIS Preliminary Design Description v1.0(TMT.INS.TEC.16.051.DRF01)](https://docushare.tmt.org/docushare/dsweb/Get/Document-56853/IRIS%20Preliminary%20Design%20Description%20v1.0.docx).
"""
        args = [
            {
                name = spectralresolution
                description = "Desired grating groove density for IFS observation. Unit is grooves/mm"
                enum = [4000-Z, 4000-Y, 4000-J, 4000-H, 4000-K, "4000-H+K", 8000-Z, 8000-Y, 8000-J, 8000-H, 8000-Kn1-3, 8000-Kn4-5, 8000-Kbb, 10000-Z, 10000-Y, 10000-J, 10000-H, 1000-K, Mirror]
            }
        ]
    }
    {
    	name = FIELDMODE_SELECT
    	description = """
This command controls masks. There are one mask for lenslet and calibration mode and one mask for slicer mode. 

Resolution argument will be checked for its validity based on the fieldmode chosen.

Instrument sequencer will determine the arguments based on spectral resolution and scale chosen.

This command can be invoked only when none of the mechanisms in this functional group is in motion.
    	"""
    	args = [
    		{
    		name = mask
    		description = "This arguments determines which mask to use."
    		enum = [lenslet, slicer]
    		}
    		{
    		name = fieldmode
    		description = "Spectral resolution to determine masking portion."
    		enum = [broadband, narrowband, ROW1, ROW2, ROW3, ROW4, ROW5, ROW6, ROW7, ROW8, ROW9, ROW10, ROW11, ROW12, ROW13, ROW14, ROW15, ROW16, ROW17, ROW18, ROW19, ROW20]
    		}
    	]
    }
    {
        name = GRATING_STOP
        description = """
This command stops the motion of all mechanisms in the grating turret.

Command type: submit
"""
    }
    {
        name = FIELDMODE_STOP
        description = """
This command stops the motion of all mechanisms in this functional group.

Command type: submit
"""
    }
    {
        name = GRATING_DEBUG
        description = """
This will set the current debug level.  This is for debugging purposes and allows the user to increase the level of logging for debugging purposes.

Command type: request
"""
    }
    {
        name = FIELDMODE_DEBUG
        description = """
This will set the current debug level.  This is for debugging purposes and allows the user to increase the level of logging for debugging purposes.

Command type: request
"""
    }
    {
        name = GRATING_TEST
        description = """
This command executes a self-test.  Actual action to be taken is TBD.

This command never drives any mechanisms.

This command can be invoked only when the grating turret is not in motion. All commands will be rejected during the test.

Command type: request
"""
    }
    {
        name = FIELDMODE_TEST
        description = """
This command executes a self-test.  Actual action to be taken is TBD.

This command never drives any mechanisms.

This command can be invoked only when none of the mechanisms in this functional group is in motion. All commands will be rejected during the test.

Command type: request
"""
    }
]
