subsystem = IRIS
component = coldstop-assembly

publish {

  description = "Telemetries published by IRIS Cold Stop Assembly."

  telemetry = [
    {
      name = position
      description = "Current position of cold stop."
      minRate = 1
      maxRate = 1
      archive = true
      archiveRate = 1
      attributes = [
        {
            name = x_pos
            description  = "Current position of X axis."
            type = float
            units = mm
        }
        {
            name = y_pos
            description  = "Current position of Y axis."
            type = float
            units = mm
        }
        {
            name = theta
            description  = "Current rotation angle of theta."
            type = float
            units = degree
        }
      ]
    }
    {
      name = status
      description = "Current general cold stop status."
      minRate = 1
      maxRate = 1
      archive = true
      archiveRate = 1
      attributes = [
        {
            name = noMotion
            description = """
This attribute becomes true if all axes are stopped.

It can be used to check if no mechanisms are in motion in Warm Stow, End Taking Daytime Calibration Data, End Night and Stow Use Case. See [IRIS - Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx) for more details about those use cases.
"""
	        type = boolean
        }
        {
            name = locked
            description = """
This attribute becomes true when this assembly is locked.

It can be used to verify mechanisms are locked in Start Pumping Use Case. See [IRIS - Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx) for more details about this use case.
"""
            type = boolean
        }
        {
            name = state
            description  = """
Current overall state of cold stop. Meaning of each value is as follows:  

* __Init:Loaded__         : __TODO__ fill out this item
* __Init:Initilizing__    : __TODO__ fill out this item
* __Init:Uninitializing__ : __TODO__ fill out this item
* __Init:Initialized__    : __TODO__ fill out this item
* __Init:Connecting__     : __TODO__ fill out this item
* __Init:Shutdown__       : __TODO__ fill out this item
* __Init:Running__        : __TODO__ fill out this item
* __Datum:Datuming__      : __TODO__ fill out this item
* __Datum:Braking__       : __TODO__ fill out this item
* __Datum:Paused__        : __TODO__ fill out this item
* __Datum:Error__         : __TODO__ fill out this item
* __Lock:Locking__        : __TODO__ fill out this item
* __Lock:Braking__        : __TODO__ fill out this item
* __Lock:Paused__         : __TODO__ fill out this item
* __Lock:Locked__         : __TODO__ fill out this item
* __Lock:Error__          : __TODO__ fill out this item
* __Park:Parking__        : __TODO__ fill out this item
* __Park:Braking__        : __TODO__ fill out this item
* __Park:Paused__         : __TODO__ fill out this item
* __Park:Parked__         : __TODO__ fill out this item
* __Park:Error__          : __TODO__ fill out this item
* __In:Tracking__         : __TODO__ fill out this item
* __In:Rotating__         : __TODO__ fill out this item
* __In:InsertedRotating__ : __TODO__ fill out this item
* __In:Braking__          : __TODO__ fill out this item
* __In:Ready__            : __TODO__ fill out this item
* __In:TrackingError__    : __TODO__ fill out this item
* __In:Error__            : __TODO__ fill out this item
* __Out:Retructing__      : __TODO__ fill out this item
* __Out:Inserting__       : __TODO__ fill out this item
* __Out:Braking__         : __TODO__ fill out this item
* __Out:Paused__          : __TODO__ fill out this item
* __Out:Retructed__       : __TODO__ fill out this item
* __Out:Error__           : __TODO__ fill out this item
* __Off:PoweringOff__     : __TODO__ fill out this item
* __Off:PoweredOff__      : __TODO__ fill out this item
* __Off:Error__           : __TODO__ fill out this item

"""
            type = string
        }
        {
            name = errorMessage
            description  = "Error message."
            type = string
        }
      ]
    }
    {
      name = theta
      description = """
This telemetry contains statuses of the theta axis that may change over time in slow rate (up to approximately 1 Hz).

__TBD__: It may be better to separate some attributes into another data structure so that the whole telemetry won't be sent over the network only one attribute is changed.

__TODO__: Check the behavior of all statuses defined in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf). Currently, 'A stop code', 'A axis reference position', 'A axis auxiliary position', 'A axis analog input', 'A Hall Input status' and some status bits in 'A xis status' and 'A axis switches' are not used in this model. If they are useful, let them in this model.
"""
      minRate = 1
      maxRate = 1
      archive = true
      archiveRate = 1
      attributes = [
        {
          name = status
          description  = """
Current status of upper prism. Meaning of each value is as follows:  

* __HOMING__    : The theta axis is finding home.
* __TRACKING__  : The theta axis is tracking upstream motion.
* __ROTATING__  : The theta axis is rotating to a designated position.
* __STOP__      : The theta axis is not rotating.
* __UNKNOWN__   : Unknown state.
"""
          enum = [HOMING, TRACKING, ROTATING, STOP, UNKNOWN]
        }
        {
          name = angle
          description  = "Current rotation angle of theta axis."
          type = float
          units = degree
          minimum = -180
          maximum = 180
          exclusiveMinimum = true
          exclusiveMaximum = false 
        }
        {
          name = targetAngle
          description  = "Demanded rotation angle of theta axis."
          type = float
          units = degree
          minimum = -180
          maximum = 180
          exclusiveMinimum = true
          exclusiveMaximum = false 
        }
        {
          name = rawAngle
          description  = """
Current raw rotation angle of theta axis. This status corresponds to ADDR 90-93 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Define maximum and minimum value.
"""
          type = integer
        }
        {
          name = targetRawAngle
          description  = """
Demanded raw rotation angle of theta axis.

__TODO__: Define maximum and minimum value.
"""
          type = integer
        }
        {
          name = rawAngleError
          description  = """
Current raw rotation angle error of the theta axis. This status corresponds to ADDR 94-97 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Define maximum and minimum value.
"""
          type = integer
        }
        {
          name = homeSwitch
          description = "Current home switch state of the theta axis." 
          type = boolean
        }
        {
          name = motorOff
          description = """
This status corresponds to BIT 0 'Motor Off' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status.
"""
          type = boolean
        }
        {
          name = finalDeceleration
          description = """
This status corresponds to BIT 3 'Motoin is making final deceleration' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status. This signal may flip very fast, so the telemetry rate may have to be very fast.
"""
          type = boolean
        }
        {
          name = stoppingForLimit
          description = """
This status corresponds to BIT 4 'Motion is stopping due to ST of Limit Switch' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'. This status supposed to be always false because theere is no limit switch in the theta axis angle.

__TODO__: Check the actual meaning of this status. This signal may flip very fast, so the telemetry rate may have to be very fast.
"""
          type = boolean
        }
        {
          name = slewing
          description = """
This status corresponds to BIT 5 'Motion is slewing' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status.
"""
          type = boolean
        }
        {
          name = negativeDirection
          description = """
This status corresponds to BIT 7 'Negative Direction Move' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status.
"""
          type = boolean
        }
        {
          name = homing
          description = """
This status corresponds to BIT 12 '(FE) Find Edge in Progress' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status.
"""
          type = boolean
        }
        {
          name = motionPAOnly
          description = """
This status corresponds to BIT 13 'Mod of Motion PA only' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status.
"""
          type = boolean
        }
        {
          name = motionMode
          description = """
This status corresponds to BIT 14 'Mode of Motion PA or PR' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status.
"""
          type = boolean
        }
        {
          name = moving
          description = """
This status corresponds to BIT 15 'Move in Progress' of ADDR 82 - 83 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check the actual meaning of this status.
"""
          type = boolean
        }
        {
          name = velocity
          description  = "Current velocity. This status corresponds to ADDR 102-105 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'."
          type = float
          units = mm/s
        }
        {
          name = torque
          description  = """
Current torque. This status corresponds to ADDR 106-109 in Data Record of [DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) if the theta axis is assigned to 'A'.

__TODO__: Check what torque value is entered here. Motion controller may simply write a value corresponding the current electric current. Thus, this attribute may be useful to check the current electric current setting. This attribute would be different from actual torque applied to the axis because there is no toqrue sensor attached.
"""
          type = float
          units = mNm
        }
      ]
    }
    {
      name = thetaConf
      description = """
Current configuration for the theta axis.

This telemetry can be used to check if the current configuration is as intended. If not, the user shoud edit the configuration via Configuration Service or a local file, and re-initialize this assembly so that the latest configuration will be reloaded. This telemetry is updated only when initialization is performed.

__TBC__: Historical record of configuration is retained by Configuration Service as described in [TMT Software Design Document (Volume 2) (TMT.SFT.TEC.12.016.DRF04)](https://docushare.tmt.org/docushare/dsweb/Get/Document-24358/TMTSoftwareDesign2_DRF04.pdf). Thus, it is not necessary to archive this telemetry.
"""
      maxRate = 1
      archive = false
      attributes = [
        {
          name = angleOffset
          description = "Offset angle from the home switch to the rotation angle of 0 degree."
          type = float
          units = degree
          minimum = -180
          maximum = 180
          exclusiveMinimum = true
          exclusiveMaximum = false 
        }
        {
          name = rawAngleOffset
          description = """
Raw offset angle from the home switch to the rotation angle of 0 degree.

__TODO__: Define maximum and minimum value.
"""
          type = integer
        }
        {
          name = acceleration
          description = """
Acceleration of trapezoidal profile for normal rotation. This value won't be applied to tracking motion.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to accelerate to the top speed.
"""
          type = float
          units = degree/s/s
        }
        {
          name = rawAcceleration
          description = """
Raw acceleration of trapezoidal profile for normal rotation. This value won't be applied to tracking motion. This value corresponds to the argument of AC command.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to accelerate to the top speed.
"""
          type = float
        }
        {
          name = deceleration
          description = """
Deceleration of trapezoidal profile for normal rotation. This value won't be applied to tracking motion.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.
"""
          type = float
          units = degree/s/s
        }
        {
          name = rawDeceleration
          description = """
Raw deceleration of trapezoidal profile for normal rotation. This value won't be applied to tracking motion. This value corresponds to the argument of DC command.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.
"""
          type = integer
        }
        {
          name = velocity
          description = """
Maximum velocity of trapezoidal profile for normal rotation. This value won't be applied to tracking motion.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.

__TBD__: Don't we need to define base velocity (start/stop velocity)? Couldn't find equivalent parameter in [Manual of DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf).
"""
          type = float
          units = degree/s
        }
        {
          name = rawVelocity
          description = """
Raw maximum velocity of trapezoidal profile for normal rotation. This value won't be applied to tracking motion. This value corresponds to the argument of SP command.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.
"""
          type = integer
        }
        {
          name = smoothing
          description = """
Smoothing factor of trapezoidal profile for normal rotation. This value won't be applied to tracking motion. See 'Motion Smoothing' chapter in [the manual of DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) for more details. The argument of KS command corresponds to this factor. 0.25 means no smoothing, and 64 means the maximum smoothing.

__TODO__: Check if the type should be integer or float. According to [the manual of DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf), this value is 'an integer from 0.25 to 64 and represents the amount of smoothing', but 0.25 is not an integer.

__TBD__: Maybe it would be useful to map this value to the range between 0 to 1 for simplicity.
"""
          type = float
          minimum = 0.25
          maximum = 64
        }
        {
          name = accelerationHoming
          description = """
Acceleration of trapezoidal profile for homing.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to accelerate to the top speed.
"""
          type = float
          units = degree/s/s
        }
        {
          name = rawAccelerationHoming
          description = """
Raw acceleration value of trapezoidal profile for homing.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to accelerate to the top speed.
"""
          type = integer
        }
        {
          name = decelerationHoming
          description = """
Deceleration of trapezoidal profile for homoing.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.
"""
          type = float
          units = degree/s/s
        }
        {
          name = rawDecelerationHoming
          description = """
Raw deceleration value of trapezoidal profile for homing. This value corresponds to the argument of DC command.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.
"""
          type = integer
        }
        {
          name = velocityHoming
          description = """
Maximum velocity of trapezoipdal profile for homing.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.

__TBD__: Don't we need to define base velocity (start/stop velocity)? Couldn't find equivalent parameter in [Manual of DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf).
"""
          type = float
          units = degree/s
        }
        {
          name = rawVelocityHoming
          description = """
Raw maximum velocity value of trapezoipdal profile for homing. This value corresponds to the argument of SP command.

__TODO__: Define maximum and minimum value. Minimum value should be larger than meaningful value. Do not allow extremly low value which may lead to very very long time to decelerate to zero.
"""
          type = integer
        }
        {
          name = smoothingHoming
          description = """
Smoothing factor of trapezoidal profile for homing. See 'Motion Smoothing' chapter in [the manual of DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf) for more details. The argument of KS command corresponds to this factor. 0.25 means no smoothing, and 64 means the maximum smoothing.

__TODO__: Check if the type should be integer or float. According to [the manual of DMC-40x0](http://www.galilmotioncontrol.com/download/manual/man_40x0.pdf), this value is 'an integer from 0.25 to 64 and represents the amount of smoothing', but 0.25 is not an integer...

__TODO__: Check if KS option is respected for Finding Edge motion.

__TBD__: Maybe it would be useful to map this value to the range between 0 to 1 for simplicity.

"""
          type = float
          minimum = 0.25
          maximum = 64
        }
      ]
    }
  ]
}