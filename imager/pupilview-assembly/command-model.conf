subsystem = IRIS
component = imager.pupilview

description = """
Commands which can be accepted by IRIS Pupil Viewing Mode Assembly.

This command model was designed based on [Software Design Patterns for Device and Component Controllers (TMT.INS.TEC.16.079)](https://docushare.tmt.org/docushare/dsweb/Services/Document-57492). As proposed by the design pattern, standard assembly commands and assembly-specific commands are provided for each functional group. All commands are classified into either 'request' or 'submit' based on the command type defintion described in the design pattern document.
"""

receive = [
    {
        name = DETECTOR-init
        description = """
This command causes the assembly to initialize its variables, read configuration, and verify dependencies.  It prepares the assembly internally such that it is available to communicate with outside processes and begin managing the detectors.  It does not cause any readout or reset on the detector, but it validates the connections and hardware presence before completing. It also applies the detector configurations DETECTOR-CONF( (e.g. gain, number of channels) to each detector. Programs and configurations (e.g. this could be DSP code in the case of ARC controller) may be downloaded to the detector controllers if necessary.

This command can be invoked only when there is no exposure in progress. All commands will be rejected during the initialization.

Initialization can fail for various reasons including HCD communication failure, hardware failure, or invalid configuration. In this case, the command state will report an error.

Command type: request
"""
    }
    {
        name = MIRROR-init
        description = """
This command causes MIRROR functional group to initialize its variables, read configuration, and verify dependencies.  It prepares this functional group internally such that it is available to communicate with outside processes and begin managing the fold mirror stage. It does not cause any motion or initiate any action on the hardware but, it validates the connections and hardware presence before completing. It may also initialize per-axis configuration of the underlying Galil HCD.

This command can be invoked only when the mirror stage is not in motion. All commands will be rejected during the initialization.

Initialization can fail for various reasons including HCD communications failure, hardware failure, or invalid configurations.  In this case, the command state will report an error.

Command type: request
"""
    }
    {
        name = DETECTOR-test
        description = """
This command executes a self-test. Actual action to be taken is TBD.

This command never starts an exposure nor reset the detector.

This command can be invoked only when there is no exposure in progress. All commands will be rejected during the test.

Command type: request
"""
    }
    {
        name = MIRROR-test
        description = """
This command executes a self-test.  Actual action to be taken is TBD.

This command never drives the mirror stage.

This command can be invoked only when the mirror stage is in motion. All commands will be rejected during the test.

Command type: request
"""
    }
    {
        name = DETECTOR-datum
        description = """
This command turns on the power of the detector if it is not on (TBC).

Command type: request
"""
    }
    {
        name = MIRROR-datum
        description = """
Perform datuming.

Command type: submit
"""
    }
    {
        name = DETECTOR-take-exposure
        description = """
This command starts a new exposure with the given parameters.

Command type: submit
"""
        requiredArgs = [filename]
        args = [
            {
                name = filename
                description = "FITS file name of this exposure"
                type = string
            }
        ]
        args = [
            {
                name = exposureTime
                description = "exposure time"
                type = float
                units = s
            }
        ]
    }
    {
        name = DETECTOR-abort-exposure
        description = """
This command aborts the current exposure in progress.

Command type: submit
"""
    }
    {
        name = MIRROR-select
        description = """
This command inserts or retracts the fold mirror into/from the science light path.

Command type: submit
"""
        requiredArgs = [target]
        args = [
            {
                name = target
                description = "Target position of the fold mirror."
                enum = [DEPLOY, RETRACT]
            }
        ]
    }
    {
        name = MIRROR-move
        description = """
This command moves the fold mirror stage to an arbitrary position.

Command type: discrete
"""
        requiredArgs = [target]
        args = [
            {
                name = target
                description = "Target position. Angle from the limit switch of the retracted position."
                type = double
                units = deg
            }
            {
                name = velocity
                description = "Motion velocity."
                type = double
                units = deg/s
                exclusiveMinimum = 0
            }
            {
                name = acceleration
                description = "Motion acceleration."
                type = double
                units = deg/s<sup>2</sup>
                exclusiveMinimum = 0
            }
            {
                name = minimumJerkTime
                description = "Minimum jerk time."
                type = double
                units = s
            }
            {
                name = maximumJerkTime
                description = "Maximum jerk time."
                type = double
                units = s
            }
        ]
        role = "eng"
    }
    {
        name = DETECTOR-disable
        description = """
This command disables this functional group.  Any commands that turn on the power or trigger a new exposure will be rejected when disabled.

This command is expected to be called before starting the cool-down or warm-up procedure.

Command type: request
"""
    }
    {
        name = MIRROR-disable
        description = """
This command disables this functional group. Any commands that trigger a motion or turn on the motor current will be rejected when disabled.

This command is expected to be called before starting the cool-down or warm-up procedure.

Command type: request
"""
    }
    {
        name = DETECTOR-enable
        description = """
This command enables this functional group.

This command is expected to be called after the cool-down or warm-up procedure is completed.

Command type: request
"""
    }
    {
        name = MIRROR-enable
        description = """
This command enables this functional group.

This command is expected to be called after the cool-down or warm-up procedure is completed.

Command type: request
"""
    }
    {
        name = DETECTOR-park
        description = """
This command cancels the exposure in progress, and turns off the detector (TBC).

Command type: submit
"""
    }
    {
        name = MIRROR-park
        description = """
This command does nothing.

Command type: submit
"""
    }
    {
        name = MIRROR-stop
        description = """
Stop the motion of the mirror stage.

Command type: submit
"""
    }
    {
        name = DETECTOR-debug
        description = """
This will set the current debug level.  This is for debugging purposes and allows the user to change the level of logging for debugging purposes.

Command type: request
"""
    }
    {
        name = MIRROR-debug
        description = """
This will set the current debug level.  This is for debugging purposes and allows the user to change the level of logging for debugging purposes.

Command type: request
"""
    }
    {
        name = shutdown
        description = """
Stop this assembly running. This will cause all of the software to exit. It does not send this command down to the underlying HCDs. If currently shutting down, all other commands will be rejected.

Command type: request
"""
    }
]
